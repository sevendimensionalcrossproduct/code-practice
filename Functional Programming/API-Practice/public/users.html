<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <title>User Page</title>
    <link rel="stylesheet" href="users.css">
  </head>
  <body>
    <header>WELCOME USERS</header>

    <button onclick="fetchUsers()">GET USERS</button>
    <button onclick="hideUsers()">HIDE USERS</button>
    <button onclick="createUser()">CREATE USER</button>
    <button onclick="getUsername()">GET USERNAME</button>
    <button onclick="wipe()">WIPE</button>
    
    <div id="output"></div>
    
    <script>
      let userJSON = 'http://localhost:3001/users';

      function fetchUsers(){
        fetch('http://localhost:3001/users')
          .then(response=> response.json())
          .then(data => displayOutput(data));
      }
      
      function createUser(){
        const newUsername = prompt('Enter username: ');
        const newUser = { userId: -1, userName: newUsername };

        fetch('http://localhost:3001/users', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(newUser),
        })
        fetchUsers();
      } 

      function getUsername() {
        const userId = prompt('Enter user ID to find: ');
        
        fetch (userJSON, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
          },
        })

        .then(response => {
          if (!response.ok){
            throw new Error ('bad response');
          }
            return response.json();
          })

        .then(users => {
          const user = users.find(u => u.userId === parseInt(userId));  
 
          if (user) {
            alert(`Username for user ID ${userId}: ${user.userName}`);
          } else {
            alert(`User with ID ${userId} not found.`);
          }
        })

        .catch(error => {
          console.error('bad retrieving user', error);
          alert(' bad retrieving user');
        });
      }

      function wipe(){
        fetch('http://localhost:3001/users', {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
          },
        })
          fetchUsers();
      }

      function displayOutput(data) {
        document.getElementById('output').innerText = JSON.stringify(data, null, 2);
      }
      
      function hideUsers() {
        document.getElementById('output').innerText = ''
      }

    </script>
  </body>
</html>
